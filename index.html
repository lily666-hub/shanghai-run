<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ä¸Šæµ·åŸå¸‚è·‘ Â· æ™ºèƒ½è·¯çº¿æ¨è</title>

  <!-- å­—ä½“ -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --accent:#00796b;
      --accent-dark:#005949;
      --card-bg: rgba(255,255,255,0.95);
      --glass: rgba(255,255,255,0.6);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:"Noto Sans SC", "Microsoft YaHei", sans-serif;
      background: linear-gradient(180deg,#e6f7fb 0%, #ffffff 40%);
      color:#333;
      -webkit-font-smoothing:antialiased;
    }

    /* hero */
    .hero{
      background: url("https://upload.wikimedia.org/wikipedia/commons/thumb/5/55/The_Bund%2C_Shanghai%2C_China.jpg/1920px-The_Bund%2C_Shanghai%2C_China.jpg") center/cover no-repeat;
      height:240px;
      display:flex;
      align-items:center;
      justify-content:center;
      color:white;
      text-align:center;
      position:relative;
    }
    .hero::after{
      content:"";
      position:absolute;left:0;right:0;top:0;bottom:0;
      background: linear-gradient(180deg, rgba(0,0,0,0.35), rgba(0,0,0,0.15));
    }
    .hero .title{
      position:relative;
      z-index:1;
      font-size:30px;
      font-weight:700;
      letter-spacing:1px;
    }
    .subtitle{
      position:relative; z-index:1; margin-top:6px; font-size:14px; opacity:0.95;
    }

    /* layout */
    .wrap{
      max-width:1100px;
      margin:-60px auto 40px;
      padding: 0 18px;
    }
    .cards{
      display:flex;
      gap:18px;
      flex-wrap:wrap;
      justify-content:center;
    }

    .card{
      width:260px;
      background:var(--card-bg);
      border-radius:14px;
      padding:18px;
      box-shadow:0 8px 24px rgba(15,30,40,0.08);
      backdrop-filter: blur(6px);
      color:#123;
    }
    .card h3{
      margin:0 0 12px; font-size:18px; color:var(--accent-dark);
      display:flex; align-items:center; gap:8px;
    }
    label{display:block; font-size:13px; margin:8px 0 6px; color:#444;}
    input[type="number"], input[type="text"], select {
      width:100%; padding:8px 10px; border-radius:8px; border:1px solid #ddd; font-size:14px;
    }
    .checkbox-group{display:flex;flex-wrap:wrap; gap:8px}
    .tag{
      background:#f1f9f8; padding:6px 10px; border-radius:12px; cursor:pointer; font-size:13px;
      border:1px solid rgba(0,0,0,0.05)
    }
    .tag.active{background:var(--accent); color:#fff; border-color:transparent}

    .button {
      margin-top:12px;
      width:100%;
      padding:12px 14px;
      border-radius:10px;
      border:none;
      cursor:pointer;
      color:#fff;
      font-weight:600;
      background:linear-gradient(180deg,var(--accent),var(--accent-dark));
      box-shadow:0 6px 18px rgba(0,121,107,0.18);
      font-size:15px;
    }

    /* map + info */
    .map-area{
      margin-top:22px;
      display:flex;
      gap:18px;
      align-items:flex-start;
      flex-wrap:wrap;
      justify-content:center;
    }
    #map {
      width:680px;
      height:420px;
      border-radius:12px;
      overflow:hidden;
      box-shadow:0 12px 28px rgba(0,0,0,0.08);
      border:1px solid rgba(0,0,0,0.06);
      background:#f7f7f7;
    }

    .result-panel{
      width:360px;
      background:var(--glass);
      border-radius:12px;
      padding:14px;
      box-shadow:0 10px 24px rgba(0,0,0,0.06);
      color:#123;
    }
    .result-card{background:#fff; padding:12px; border-radius:10px; margin-bottom:12px; border:1px solid #eee}
    .result-card h4{margin:0 0 6px; color:var(--accent-dark)}
    .result-row{display:flex;justify-content:space-between; font-size:14px; margin:6px 0}
    .route-photo{width:100%; height:120px; object-fit:cover; border-radius:8px; margin-top:8px}

    /* footer note */
    .note{font-size:12px; text-align:center; color:#666; margin-top:18px}
    @media(max-width:980px){
      #map{width:100%;height:340px}
      .result-panel{width:100%}
      .cards{justify-content:center}
    }
  </style>
</head>
<body>

  <div class="hero">
    <div>
      <div class="title">è·‘è¿‡ä¸Šæµ·ï¼Œæ¯ä¸€æ­¥éƒ½æ˜¯é£æ™¯</div>
      <div class="subtitle">åœ¨åŸå¸‚é‡Œè·‘ï¼Œæ„Ÿå—å†å²ä¸ç°ä»£çš„äº¤è Â· åŒæ—¶é”»ç‚¼èº«ä½“ã€æ”¶è·ä¹è¶£</div>
    </div>
  </div>

  <div class="wrap">
    <div class="cards">
      <!-- card 1: ä½“èƒ½åŸºç¡€ -->
      <div class="card" id="card-basic">
        <h3>ä½“èƒ½åŸºç¡€</h3>
        <label>èº«é«˜ (cm)</label>
        <input type="number" id="height" min="80" max="250" placeholder="ä¾‹å¦‚ 170">
        <label>ä½“é‡ (kg)</label>
        <input type="number" id="weight" min="20" max="300" placeholder="ä¾‹å¦‚ 60">
        <label>å¹´é¾„</label>
        <input type="number" id="age" min="8" max="120" placeholder="ä¾‹å¦‚ 28">
      </div>

      <!-- card 2: è¿åŠ¨åå¥½ -->
      <div class="card" id="card-prefer">
        <h3>è¿åŠ¨åå¥½</h3>
        <label>é¢„æœŸè·‘æ­¥è·ç¦» (km)</label>
        <input type="number" id="distance" step="0.1" placeholder="ä¾‹å¦‚ 5">
        <label>é¢„æœŸæ—¶é•¿ (åˆ†é’Ÿ)</label>
        <input type="number" id="duration" placeholder="ä¾‹å¦‚ 30">
        <label>ç›®æ ‡é…é€Ÿ (min/kmï¼Œå¯ç•™ç©ºç”±è·ç¦»+æ—¶é•¿è®¡ç®—)</label>
        <input type="text" id="pace" placeholder="ä¾‹å¦‚ 6 æˆ– 6:00">
      </div>

      <!-- card 3: å…´è¶£è·¯çº¿ -->
      <div class="card" id="card-interest">
        <h3>å…´è¶£è·¯çº¿</h3>
        <div class="checkbox-group" id="interestTags">
          <div class="tag" data-val="å†å²å»ºç­‘">å†å²å»ºç­‘</div>
          <div class="tag" data-val="ç°ä»£è‰ºæœ¯">ç°ä»£è‰ºæœ¯</div>
          <div class="tag" data-val="è‡ªç„¶é£å…‰">è‡ªç„¶é£å…‰</div>
          <div class="tag" data-val="å¸‚äº•çƒŸç«æ°”">å¸‚äº•çƒŸç«æ°”</div>
        </div>
      </div>

      <!-- card 4: æŒ‘æˆ˜ç›®æ ‡ -->
      <div class="card" id="card-challenge">
        <h3>æŒ‘æˆ˜ç›®æ ‡</h3>
        <label><input type="checkbox" id="virtualRace"> å¼€å¯è™šæ‹Ÿç«èµ›</label>
        <label style="margin-top:10px">æœ€ä½³æˆç»©ï¼ˆè¯¥è·ç¦»ï¼Œæ€»ç”¨æ—¶ï¼Œåˆ†é’Ÿï¼‰</label>
        <input type="number" id="bestTime" placeholder="ä¾‹å¦‚ 25">
        <button class="button" id="btnGenerate">ç”Ÿæˆæˆ‘çš„ä¸“å±ä¸Šæµ·è·‘è·¯çº¿</button>
      </div>
    </div>

    <div class="map-area">
      <div id="map"></div>

      <div class="result-panel">
        <div class="result-card" id="card-bmi">
          <h4>ä½“èƒ½è¯„ä¼° Â· BMI</h4>
          <div class="result-row"><div>BMI</div><div id="bmi">â€”</div></div>
          <div class="result-row"><div>ä½“èƒ½å»ºè®®</div><div id="bmiAdvice">â€”</div></div>
        </div>

        <div class="result-card" id="card-energy">
          <h4>è¿åŠ¨å»ºè®® Â· ä¼°ç®—</h4>
          <div class="result-row"><div>é¢„è®¡é…é€Ÿ</div><div id="estPace">â€”</div></div>
          <div class="result-row"><div>é¢„è®¡æ¶ˆè€— (kcal)</div><div id="calorie">â€”</div></div>
          <div class="result-row"><div>å¼ºåº¦å»ºè®®</div><div id="intensity">â€”</div></div>
        </div>

        <div class="result-card" id="card-route">
          <h4>è·¯çº¿æ¨è</h4>
          <div class="result-row"><div>å…´è¶£</div><div id="selTags">â€”</div></div>
          <div class="result-row"><div>æ¨èè·¯çº¿</div><div id="routeName">â€”</div></div>
          <img id="routePhoto" class="route-photo" src="" alt="è·¯çº¿å›¾ç¤º" style="display:none">
        </div>

        <div class="result-card" id="card-ch">
          <h4>æŒ‘æˆ˜åé¦ˆ</h4>
          <div class="result-row"><div>æ˜¯å¦ç«èµ›</div><div id="raceOn">â€”</div></div>
          <div class="result-row"><div>è¿›åº¦æç¤º</div><div id="raceMsg">â€”</div></div>
        </div>

        <div class="note">æç¤ºï¼šè·¯çº¿ä¸ºæ¨èç¤ºä¾‹ï¼ŒçœŸå®è·‘æ­¥è¯·å…³æ³¨å®‰å…¨ä¸é“è·¯äº¤é€šè§„åˆ™ã€‚</div>
      </div>
    </div>
  </div>

  <!-- é«˜å¾·åœ°å›¾ï¼ˆä½¿ç”¨ä½ æä¾›çš„ keyï¼‰ -->
  <script src="https://webapi.amap.com/maps?v=2.0&key=5c65d76d3600ef99bc76b95adb89c022"></script>

  <script>
    // ========== è·¯çº¿æ•°æ®ï¼ˆé¢„å®šä¹‰å‡ æ¡ç¤ºä¾‹è·¯çº¿ï¼Œå«åæ ‡ä¸ç¤ºæ„å›¾ï¼‰ ==========
    const ROUTES = {
      "å†å²å»ºç­‘": {
        name: "å¤–æ»© â€” å—äº¬ä¸œè·¯ â€” è±«å›­",
        coords: [
          [121.4905,31.2410], // approximate bund
          [121.4900,31.2350],
          [121.4820,31.2340],
          [121.4870,31.2260] // yuz garden area
        ],
        photo: "https://upload.wikimedia.org/wikipedia/commons/7/7b/The_Bund_%28Shanghai%29_2014.jpg"
      },
      "ç°ä»£è‰ºæœ¯": {
        name: "è¥¿å²¸ç¾æœ¯é¦† â€” é¾™ç¾æœ¯é¦† â€” å¾æ±‡æ»¨æ±Ÿ",
        coords: [
          [121.4425,31.2186], // west bund
          [121.4550,31.2230],
          [121.4510,31.2100]
        ],
        photo: "https://upload.wikimedia.org/wikipedia/commons/5/5c/West_Bund_Museum.jpg"
      },
      "è‡ªç„¶é£å…‰": {
        name: "ä¸–çºªå…¬å›­ç¯çº¿",
        coords: [
          [121.5400,31.2176],
          [121.5440,31.2130],
          [121.5320,31.2115]
        ],
        photo: "https://upload.wikimedia.org/wikipedia/commons/2/20/Century_Park%2C_Shanghai_%28cropped%29.jpg"
      },
      "å¸‚äº•çƒŸç«æ°”": {
        name: "ä¸ƒå®è€è¡— â€” å—ç¿”å¤é•‡ï¼ˆçŸ­çº¿ï¼‰",
        coords: [
          [121.3960,31.1486],
          [121.3090,31.2850],
        ],
        photo: "https://upload.wikimedia.org/wikipedia/commons/4/4b/Qibao_Old_Street.jpg"
      }
    };

    // ========== åœ°å›¾åˆå§‹åŒ– ==========
    const map = new AMap.Map('map', {
      center: [121.4737,31.2304],
      zoom: 12,
    });

    let currentPolyline = null;
    let currentMarkers = [];

    // ç‚¹å‡»æ ‡ç­¾äº¤äº’
    document.querySelectorAll('.tag').forEach(tag=>{
      tag.addEventListener('click', ()=> {
        tag.classList.toggle('active');
      });
    });

    // ç‚¹å‡»ç”Ÿæˆ
    document.getElementById('btnGenerate').addEventListener('click', onGenerate);

    function onGenerate(){
      // è¯»å–è¾“å…¥
      const h = parseFloat(document.getElementById('height').value) || null;
      const w = parseFloat(document.getElementById('weight').value) || null;
      const age = parseInt(document.getElementById('age').value) || null;
      const dist = parseFloat(document.getElementById('distance').value) || null;
      const duration = parseFloat(document.getElementById('duration').value) || null; // minutes
      let paceInput = document.getElementById('pace').value.trim();
      if(paceInput && paceInput.includes(':')){
        const parts = paceInput.split(':').map(s=>parseInt(s));
        if(parts.length===2 && !isNaN(parts[0]) && !isNaN(parts[1])){
          paceInput = parts[0] + parts[1]/60;
        } else paceInput = "";
      }
      const pace = (paceInput!=="" && !isNaN(paceInput)) ? parseFloat(paceInput) : null; // min per km
      const bestTime = parseFloat(document.getElementById('bestTime').value) || null;
      const raceOn = document.getElementById('virtualRace').checked;

      // é€‰ä¸­æ ‡ç­¾
      const sel = Array.from(document.querySelectorAll('.tag.active')).map(t=>t.dataset.val);
      // =========== 1. BMI è®¡ç®— ===========
      if(h && w){
        const bmi = (w / Math.pow(h/100,2));
        document.getElementById('bmi').innerText = bmi.toFixed(1);
        let advice="";
        if(bmi < 18.5) advice="åç˜¦ï¼šå»ºè®®é€æ­¥å¢åŠ è€åŠ›è®­ç»ƒå¹¶æ³¨æ„è¥å…»è¡¥ç»™ã€‚";
        else if(bmi < 24) advice="æ­£å¸¸ï¼šç»´æŒè®­ç»ƒå¼ºåº¦ï¼Œæ³¨æ„æ¸è¿›å¼æå‡ã€‚";
        else advice="åé‡ï¼šå»ºè®®ä»¥ä½å†²å‡»æœ‰æ°§ä¸ºä¸»ï¼Œå¾ªåºæ¸è¿›ã€‚";
        document.getElementById('bmiAdvice').innerText = advice;
      } else {
        document.getElementById('bmi').innerText = "â€”";
        document.getElementById('bmiAdvice').innerText = "è¯·å¡«å†™èº«é«˜ä¸ä½“é‡ä»¥è·å¾—ä½“èƒ½è¯„ä¼°ã€‚";
      }

      // =========== 2. é¢„è®¡é…é€Ÿ / å¡è·¯é‡Œ ===========
      // è®¡ç®—é¢„æœŸé…é€Ÿï¼š ä¼˜å…ˆä½¿ç”¨ç”¨æˆ·è¾“å…¥ paceï¼›è‹¥æ— ï¼Œç”¨ distance & duration è®¡ç®—
      let estPace = null;
      if(pace) estPace = pace; // min/km
      else if(dist && duration) estPace = (duration / dist);

      if(estPace){
        // æ˜¾ç¤º mm:ss style if integer
        const minPart = Math.floor(estPace);
        const secPart = Math.round((estPace - minPart)*60);
        document.getElementById('estPace').innerText = `${minPart}:${String(secPart).padStart(2,'0')} min/km`;
      } else {
        document.getElementById('estPace').innerText = "â€”";
      }

      // å¡è·¯é‡Œä¼°ç®—ï¼ˆåŸºäº MET å¤§è‡´å€¼ï¼‰
      let kcalText = "â€”";
      if(w && (duration || (dist && estPace))){
        const durMin = duration ? duration : (dist * estPace);
        // ç®€å•ç”¨é…é€Ÿå†³å®š MET
        const paceVal = estPace || 8;
        let MET = 6;
        if(paceVal < 4.5) MET = 12;
        else if(paceVal < 6) MET = 10;
        else if(paceVal < 7) MET = 8;
        else MET = 6;
        const calories = MET * w * (durMin/60);
        kcalText = Math.round(calories) + " kcal";
        document.getElementById('calorie').innerText = kcalText;
      } else {
        document.getElementById('calorie').innerText = "è¯·å¡«å†™ä½“é‡ä¸æ—¶é•¿æˆ–è·ç¦»";
      }

      // å¼ºåº¦å»ºè®®
      let intensity = "â€”";
      if(estPace){
        if(estPace < 5) intensity = "é«˜å¼ºåº¦ï¼ˆå»ºè®®é—´æ­‡è®­ç»ƒï¼‰";
        else if(estPace < 6.5) intensity = "ä¸­é«˜å¼ºåº¦ï¼ˆå¯æŒç»­è®­ç»ƒï¼‰";
        else intensity = "ä¸­ä½å¼ºåº¦ï¼ˆé€‚åˆæ…¢è·‘æ¢å¤ï¼‰";
      }
      document.getElementById('intensity').innerText = intensity;

      // =========== 3. è·¯çº¿æ¨èï¼ˆä¼˜å…ˆæŒ‰æ ‡ç­¾ï¼‰ ===========
      document.getElementById('selTags').innerText = sel.length ? sel.join('ã€') : "æœªé€‰æ‹©";
      // pick first matched route; if none, pick default
      let chosen = null;
      if(sel.length){
        for(const s of sel){
          if(ROUTES[s]){ chosen = ROUTES[s]; break; }
        }
      }
      if(!chosen){
        // default: å†å²å»ºç­‘ï¼ˆå¤–æ»©ï¼‰
        chosen = ROUTES["å†å²å»ºç­‘"];
      }
      document.getElementById('routeName').innerText = chosen.name;
      // show photo
      const img = document.getElementById('routePhoto');
      img.src = chosen.photo;
      img.style.display = 'block';

      // draw route on map
      drawRouteOnMap(chosen.coords);

      // =========== 4. è™šæ‹Ÿç«èµ›åˆ†æ ===========
      document.getElementById('raceOn').innerText = raceOn ? "æ˜¯" : "å¦";
      let raceMsg = "æœªå¼€å¯è™šæ‹Ÿç«èµ›ã€‚";
      if(raceOn && bestTime && dist){
        // bestTime = best total minutes for this distance (user input), compare expected total time
        const expectedTotal = (estPace && dist) ? (estPace * dist) : (duration ? duration : null);
        if(expectedTotal){
          const diff = expectedTotal - bestTime;
          if(diff < -0.1){
            raceMsg = `ğŸ‰ å¤ªæ£’äº†ï¼é¢„è®¡æ¯”ä½ çš„æœ€ä½³æˆç»©å¿« ${Math.abs(diff).toFixed(1)} åˆ†é’Ÿã€‚`;
          } else if(diff <= 0.5){
            raceMsg = `ğŸ”¥ å¾ˆæ¥è¿‘æœ€ä½³æˆç»©ï¼Œä»…å·® ${diff.toFixed(1)} åˆ†é’Ÿï¼Œå†²åˆºå¯åˆ·æ–°çºªå½•ï¼`;
          } else {
            raceMsg = `ğŸ’ª ç»§ç»­è®­ç»ƒï¼é¢„è®¡è¿˜å·® ${diff.toFixed(1)} åˆ†é’Ÿä»¥æ‰“ç ´çºªå½•ã€‚`;
          }
        } else {
          raceMsg = "è¯·å¡«å†™è·ç¦»ä¸æ—¶é•¿/é…é€Ÿä»¥åˆ†æç«èµ›æˆç»©ã€‚";
        }
      }
      document.getElementById('raceMsg').innerText = raceMsg;

      // small UX alert
      // window.scrollTo({top: document.getElementById('map').offsetTop - 20, behavior:'smooth'});
    }

    // draw route
    function clearRoute(){
      if(currentPolyline){ map.remove(currentPolyline); currentPolyline = null; }
      currentMarkers.forEach(m => map.remove(m));
      currentMarkers = [];
    }
    function drawRouteOnMap(coords){
      clearRoute();
      // convert to AMap.LngLat objects if needed
      const path = coords.map(c => new AMap.LngLat(c[0], c[1]));
      currentPolyline = new AMap.Polyline({
        path: path,
        strokeColor: "#00796b",
        strokeWeight: 6,
        lineJoin: 'round',
        lineCap: 'round',
      });
      map.add(currentPolyline);
      // add markers
      coords.forEach((c,i)=>{
        const marker = new AMap.Marker({
          position: c,
          title: i===0 ? 'èµ·ç‚¹' : (i===coords.length-1 ? 'ç»ˆç‚¹' : `é€”ç»${i}`),
        });
        map.add(marker);
        currentMarkers.push(marker);
      });
      map.setFitView([currentPolyline]);
    }

    // åˆå§‹åŒ–æ—¶æ˜¾ç¤ºé»˜è®¤è·¯çº¿
    window.onload = () => {
      // draw default historical route
      drawRouteOnMap(ROUTES["å†å²å»ºç­‘"].coords);
      document.getElementById('routePhoto').src = ROUTES["å†å²å»ºç­‘"].photo;
      document.getElementById('routePhoto').style.display = 'block';
      document.getElementById('routeName').innerText = ROUTES["å†å²å»ºç­‘"].name;
      document.getElementById('selTags').innerText = "å†å²å»ºç­‘ï¼ˆé»˜è®¤ï¼‰";
    }
  </script>
</body>
</html>
